<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Open Card Sort (Unlabeled Piles)</title>

  <style>
    :root { --gap:16px; --purple:#a78bfa; --purple-text:#3b2f66; }
    * { box-sizing: border-box; }

    /* Let the parent control height; avoid inner scrollbars */
    html, body { margin:0; padding:0; height:auto; min-height:100%; overflow:visible; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:#222;
      font-size: 18px;
      line-height: 1.5;
    }

    /* Header: full-width instructions (no heading) */
    .header {
      display:block;
      margin: 16px;
    }
    h1 { display:none; } /* remove the old heading */
    .instructions {
      color:#444; font-size: 18px; line-height:1.6; margin:0;
      background:#fafafa; border:1px solid #eee; border-radius: 10px; padding: 14px 16px;
    }

    /* All cards panel — fill width */
    .panel {
      background:#f8f9fb; border:1px solid #e6e7eb; border-radius: 12px;
      padding: 20px; margin: 0 16px 16px; max-width: none;
    }
    .panel h2 { font-size: 16px; margin: 0 0 10px 0; }
    .allgrid {
      display:grid;
      grid-template-columns: repeat(2, minmax(320px, 1fr));
      gap: var(--gap);
    }
    .list { min-height: 260px; background: #fff; border:1px dashed #d4d7dd; border-radius:10px; padding:12px; }
    .card { font-size:16px; padding: 12px; margin: 10px 0; background: white; border: 1px solid #ddd; border-radius: 10px; cursor: grab; }

    /* Controls above piles */
    .controlsRow { display:flex; gap:10px; align-items:center; margin: 14px 16px 8px; }
    .addBtn, .delBtn {
      padding: 8px 12px; border-radius: 10px; border:1px solid #ccc; background:#fff; cursor:pointer;
    }
    .addBtn:hover, .delBtn:hover { background:#f4f4f4; }

    /* Piles strip */
    .pilesGrid {
      display: flex;
      flex-direction: row;
      gap: var(--gap);
      overflow-x: auto;
      padding: 0 16px 12px;
      width: 100%;
    }
    .pile {
      flex: 0 0 320px;
      background:#fafafa;
      border:1px solid #e6e7eb;
      border-radius:12px;
      padding:12px;
      min-height: 200px;
    }
    .pileHeader { display:flex; align-items:center; }
    .pileLabel { font-weight:600; font-size: 14px; }
    .spacer { flex:1; }
    .pileList { min-height: 160px; background:#fff; border:1px dashed #d4d7dd; border-radius:10px; padding:12px; margin-top:8px; }

    /* Exclude bin: shorter */
    .exclude {
      background:#fff6f6; border:1px solid #f5c8c8; border-radius:12px; padding:12px;
      margin: 0 16px 20px;
    }
    .exclude h3 { margin:0 0 8px 0; font-size:16px; color:#a33; }
    .hint { font-size:13px; color:#666; }

    @media (max-width: 700px){
      .header { margin: 12px; }
      .panel { margin: 0 12px 12px; }
      .controlsRow { margin: 12px; }
      .allgrid { grid-template-columns: 1fr; }
      .pile { flex-basis: 280px; }
    }

    /* Make the exclude list itself shorter with internal scroll if needed */
    #exclude { max-height: 160px; overflow:auto; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
</head>
<body>

  <!-- Full-width instructions (no H1) -->
  <div class="header">
    <p class="instructions">
      On these cards you will find descriptions of different goals and plans that one can have and find important in life.
      Please read each of these cards carefully and sort the cards into several piles with respect to how important these
      goals and plans are for you personally. You may build as many piles as you think necessary.
    </p>
  </div>

  <!-- Importance guide -->
  <div id="importance-rail" aria-hidden="true">
    <span>Most important</span>
    <div class="rail"></div>
    <span>Less important or not important</span>
  </div>

  <!-- All cards -->
  <div class="panel" style="margin-bottom:14px;">
    <h2>All cards</h2>
    <div class="allgrid">
      <div id="allA" class="list"></div>
      <div id="allB" class="list"></div>
    </div>
    <p class="hint" style="margin-top:8px;">Drag cards from here into your piles below.</p>
  </div>

  <!-- Controls + piles -->
  <div class="controlsRow">
    <button id="addPileBtn" class="addBtn">+ Add pile</button>
    <span class="hint">Create more piles and drag cards between them.</span>
  </div>
  <div id="pilesGrid" class="pilesGrid"></div>

<!-- Importance guide -->
<div id="importance-rail" aria-hidden="true">
  <span>Most important</span>
  <div class="rail"></div>
  <span>Less important or not important</span>
</div>
  
<!-- Exclude bin -->
<div class="exclude" style="margin-top:16px;">
  <h3>Exclude (discard)</h3>
  <!-- Set max-height ≈ one card, add scroll if more cards are dropped -->
  <div id="exclude" class="list" style="max-height:64px; overflow:auto;"></div>
  <p class="hint">Drop here to exclude a card from your piles.</p>
</div>


  <script>
    // =========================
    // CONFIG — EDIT THESE
    // =========================
    const CARDS = [
      "Have strong power of discernment",          // 1
      "Not depend on someone else’s feelings",     // 2
      "Determine my future by myself",             // 3
      "Be autonomous in my feelings",              // 4
      "Receive approval for my work",              // 5
      "Have good friends who accept me the way I am", // 6
      "Be with people who set high value on my opinion", // 7
      "Have close friends who trust me",           // 8
      "Be able to confide in a close friend at any time", // 10
      "Receive good advice on important decision", // 11
      "Not feel lonely",                           // 12
      "Leave my mark on this world",               // 13
      "Be available to others who need to be comforted", // 14
      "Give my knowledge/experience on to others", // 15
      "Help others to find their purpose in life", // 16
      "Have large experience of life",             // 17
      "Know myself and my feelings very well",     // 18
      "Be well educated and knowledgeable",        // 19
      "Have control over my feelings",             // 20
    ];

    // Optional enforcement
    const REQUIRE_ALL_PLACED = false;

    // Qualtrics/parent origin for postMessage security:
    const targetOrigin = "https://nyu.qualtrics.com"; // ← EDIT if needed

    // =========================
    // Query string IDs (optional)
    // =========================
    const qs = new URLSearchParams(location.search);
    const prolificId = qs.get("pid") || "";
    const responseId = qs.get("rid") || "";

    // =========================
    // Build All-cards (two lists) and Exclude
    // =========================
    const allA = document.getElementById("allA");
    const allB = document.getElementById("allB");
    const excludeList = document.getElementById("exclude");
    const pilesGrid = document.getElementById("pilesGrid");
    let pileCounter = 0;

    function makeCard(text) {
      const el = document.createElement("div");
      el.className = "card";
      el.dataset.card = text;
      el.textContent = text;
      return el;
    }
    CARDS.forEach((c, i) => (i % 2 === 0 ? allA : allB).appendChild(makeCard(c)));

    const listOptions = {
      group: "cards",
      animation: 150,
      ghostClass: "dragGhost",
      onEnd: () => { notifyHeight(); dispatchEvent(new Event('cardsChanged')); }
    };
    new Sortable(allA, listOptions);
    new Sortable(allB, listOptions);
    new Sortable(excludeList, listOptions);

    // =========================
    // Piles (unlabeled)
    // =========================
    function createPile() {
      pileCounter++;
      const pileId = "pile_" + pileCounter;

      const wrap = document.createElement("div");
      wrap.className = "pile";

      const header = document.createElement("div");
      header.className = "pileHeader";

      const label = document.createElement("div");
      label.className = "pileLabel";
      label.textContent = "Pile " + pileCounter;

      const spacer = document.createElement("div");
      spacer.className = "spacer";

      const delBtn = document.createElement("button");
      delBtn.className = "delBtn";
      delBtn.textContent = "Delete pile";

      const list = document.createElement("div");
      list.className = "pileList";
      list.id = pileId;

      header.appendChild(label);
      header.appendChild(spacer);
      header.appendChild(delBtn);
      wrap.appendChild(header);
      wrap.appendChild(list);
      pilesGrid.appendChild(wrap);

      new Sortable(list, listOptions);

      delBtn.addEventListener("click", () => {
        const hasCards = list.children.length > 0;
        if (hasCards && !confirm("This pile has cards. Delete anyway? Cards will move back to All cards.")) return;
        Array.from(list.children).forEach((ch, i) => (i % 2 === 0 ? allA : allB).appendChild(ch));
        wrap.remove();
        renumberPiles();
        notifyHeight();
      });

      notifyHeight();
      return pileId;
    }

    function renumberPiles() {
      const piles = Array.from(pilesGrid.children);
      pileCounter = 0;
      piles.forEach(p => {
        pileCounter++;
        p.querySelector(".pileLabel").textContent = "Pile " + pileCounter;
      });
    }

    // Start with exactly ONE pile
    createPile();

    document.getElementById("addPileBtn").addEventListener("click", () => {
      createPile();
    });

    // =========================
    // Data helpers
    // =========================
    function readList(el) {
      return Array.from(el.children).map(ch => ch.dataset.card);
    }
    function getAllUnplaced() {
      return readList(allA).concat(readList(allB));
    }
    function getPilesData() {
      return Array.from(pilesGrid.children).map((pileEl, idx) => {
        const listDiv = pileEl.querySelector(".pileList");
        return { id: listDiv.id, index: idx + 1, cards: readList(listDiv) };
      });
    }
    function getResults() {
      return {
        meta: {
          prolificId,
          responseId,
          startedAt: window.__startedAt || new Date().toISOString(),
          finishedAt: new Date().toISOString(),
          userAgent: navigator.userAgent
        },
        allCards: CARDS.slice(),
        piles: getPilesData(),
        exclude: readList(excludeList),
        unplaced: getAllUnplaced()
      };
    }
    window.__startedAt = new Date().toISOString();

    function validate(results) {
      if (REQUIRE_ALL_PLACED && results.unplaced.length > 0) {
        alert("Please sort all cards into piles or Exclude before continuing.");
        return false;
      }
      return true;
    }

    // =========================
    // Auto-resize → tell parent our height (no inner scrolling)
    // =========================
    function notifyHeight() {
      const h = Math.max(
        document.documentElement.scrollHeight,
        document.body.scrollHeight,
        document.documentElement.offsetHeight,
        document.body.offsetHeight
      );
      parent.postMessage({ type: 'iframesizer:height', height: h }, '*');
    }
    const ro = new ResizeObserver(() => notifyHeight());
    ro.observe(document.body);
    window.addEventListener('load', notifyHeight);
    setTimeout(notifyHeight, 100);

    // =========================
    // Qualtrics handshake (parent controls save/continue)
    // =========================
    window.addEventListener('message', (e) => {
      const msg = e.data || {};
      if (msg && msg.type === 'qualtrics:requestData') {
        const payload = getResults();
        if (!validate(payload)) return; // only blocks if REQUIRE_ALL_PLACED is true
        // Include remaining count so parent can warn if desired
        const remaining = payload.unplaced.length;
        parent.postMessage({ type: 'qualtrics:payload', payload: { ...payload, remainingInAllCards: remaining } }, targetOrigin);
      }
    });

    // (Removed Finish button and any related UI)
  </script>
</body>
</html>
