<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Open Card Sort</title>

<style>
  :root { --gap:16px; }
  * { box-sizing: border-box; }
  html, body { margin:0; padding:0; height:auto; min-height:100%; overflow:visible; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#222; font-size:18px; line-height:1.5; }

  /* Top instructions (top→down wording) */
  .header { margin:16px; }
  .instructions{
    color:#444; font-size:18px; line-height:1.6;
    background:#fafafa; border:1px solid #eee; border-radius:10px; padding:14px 16px; margin:0;
  }

  /* Two-column page layout:
     Left column = fixed narrow All-cards lane
     Right column = flexible piles area */
  .layout {
    display:grid;
    grid-template-columns: 360px 1fr;   /* <- make left column narrower so piles always fit */
    gap: var(--gap);
    padding: 0 16px 24px;
  }

  /* LEFT: All cards column (narrow) */
  .panel {
    background:#f8f9fb; border:1px solid #e6e7eb; border-radius:12px;
    padding:16px; max-width:360px;   /* hard cap so it never expands */
  }
  .panelHead { display:flex; align-items:baseline; gap:10px; flex-wrap:wrap; margin:0 0 10px 0; }
  .panelHead h2 { font-size:16px; margin:0; }
  .inlineHint { font-size:13px; color:#666; }

  /* Single, tall list for All cards (cards are slightly more compact) */
  #allList.list { min-height:600px; }  /* tall source column, feels less scroll-y */
  .list { background:#fff; border:1px dashed #d4d7dd; border-radius:10px; padding:10px; }
  .card {
    font-size:15px;                 /* a touch smaller */
    padding:10px;                   /* tighter card padding */
    margin:8px 0;
    background:#fff; border:1px solid #ddd; border-radius:10px; cursor:grab;
    max-width: 330px;               /* keep each card narrow as well */
  }

  /* RIGHT: Piles column */
  .rightPane { display:flex; flex-direction:column; gap:10px; min-width:520px; }
  .controlsRow { display:flex; justify-content:flex-end; align-items:center; gap:12px; }
  .addBtn, .delBtn { padding:8px 12px; border-radius:10px; border:1px solid #ccc; background:#fff; cursor:pointer; white-space:nowrap; }
  .addBtn:hover, .delBtn:hover { background:#f4f4f4; }

  .pilesColumn { position:relative; display:flex; flex-direction:column; gap: var(--gap); }
  .pile {
    position:relative;
    background:#fafafa; border:1px solid #e6e7eb; border-radius:12px; padding:12px; min-height:200px;
  }
  .pileHeader { display:flex; align-items:center; }
  .pileLabel { font-weight:600; font-size:14px; }
  .spacer { flex:1; }
  .pileList { min-height:160px; background:#fff; border:1px dashed #d4d7dd; border-radius:10px; padding:12px; margin-top:8px; }

  /* “Most important →” centered to the right of Pile 1 */
  .sideTag {
    position:absolute;
    top:50%; transform:translateY(-50%);
    right:-150px; width:140px; color:#444; font-size:14px; white-space:nowrap; pointer-events:none;
    text-align:left;
  }

  /* Bottom note further down the page */
  .bottomGuide { margin: 6px 16px 0 16px; color:#444; font-size:14px; text-align:center; }

  /* Responsive: on narrow screens, become single-column (left over right) */
  @media (max-width: 980px){
    .layout { grid-template-columns: 1fr; }
    .panel { max-width:none; }
    .rightPane { min-width:0; }
    .sideTag { position:static; transform:none; right:auto; width:auto; margin:6px 0 -4px auto; text-align:right; }
    #allList.list { min-height:360px; }
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
</head>
<body>

  <!-- Instructions (top→down ordering) -->
  <div class="header">
    <p class="instructions">
      On these cards you will find descriptions of different goals and plans that one can have and find important in life.
      Please read each of these cards carefully and sort the cards into several piles with respect to how important these
      goals and plans are for you personally. Again, please begin at the <strong>top</strong> with the pile of those goals and plans
      which are most important to you. Please order those goals and plans that are less important or not important at all
      to you into piles further <strong>down the page</strong>. You may build as many piles as you think necessary.
    </p>
  </div>

  <div class="layout">
    <!-- LEFT: All cards -->
    <div class="panel">
      <div class="panelHead">
        <h2>All cards</h2>
        <span class="inlineHint">Drag cards from here into your piles on the right.</span>
      </div>
      <div id="allList" class="list"></div>
    </div>

    <!-- RIGHT: Piles -->
    <div class="rightPane">
      <div class="controlsRow">
        <button id="addPileBtn" class="addBtn">+ Add pile</button>
      </div>
      <div id="pilesColumn" class="pilesColumn"></div>
    </div>
  </div>

  <div class="bottomGuide">↓ Less important or not important</div>

  <script>
    /* ---------- Config ---------- */
    const CARDS = [
      "Have strong power of discernment","Not depend on someone else’s feelings","Determine my future by myself",
      "Be autonomous in my feelings","Receive approval for my work","Have good friends who accept me the way I am",
      "Be with people who set high value on my opinion","Have close friends who trust me",
      "Be able to confide in a close friend at any time","Receive good advice on important decision","Not feel lonely",
      "Leave my mark on this world","Be available to others who need to be comforted","Give my knowledge/experience on to others",
      "Help others to find their purpose in life","Have large experience of life","Know myself and my feelings very well",
      "Be well educated and knowledgeable","Have control over my feelings"
    ];
    const targetOrigin = "https://nyu.qualtrics.com"; // keep origin only

    /* ---------- Build DOM ---------- */
    const allList  = document.getElementById("allList");
    const pilesCol = document.getElementById("pilesColumn");

    function makeCard(text){
      const el=document.createElement("div");
      el.className="card"; el.dataset.card=text; el.textContent=text;
      return el;
    }
    CARDS.forEach(c => allList.appendChild(makeCard(c)));

    const listOptions={ group:"cards", animation:150, ghostClass:"dragGhost", onEnd:()=>notifyHeight() };
    new Sortable(allList, listOptions);

    let pileCounter=0;
    function createPile(){
      pileCounter++;
      const wrap=document.createElement("div"); wrap.className="pile";
      const header=document.createElement("div"); header.className="pileHeader";
      const label=document.createElement("div"); label.className="pileLabel"; label.textContent="Pile "+pileCounter;
      const spacer=document.createElement("div"); spacer.className="spacer";
      const delBtn=document.createElement("button"); delBtn.className="delBtn"; delBtn.textContent="Delete pile";
      const list=document.createElement("div"); list.className="pileList"; list.id="pile_"+pileCounter;
      header.append(label,spacer,delBtn); wrap.append(header,list); pilesCol.append(wrap);
      new Sortable(list,listOptions);

      delBtn.onclick=()=>{ Array.from(list.children).forEach(ch=>allList.appendChild(ch)); wrap.remove(); renumberPiles(); ensureSideTagAnchored(); notifyHeight(); };

      ensureSideTagAnchored();  // make sure the tag is on the first pile
      notifyHeight();
      return list.id;
    }
    function renumberPiles(){
      pileCounter=0;
      Array.from(pilesCol.children).forEach(p=>{ pileCounter++; p.querySelector(".pileLabel").textContent="Pile "+pileCounter; });
    }

    // Start with one pile at top; new piles stack below
    createPile();
    document.getElementById("addPileBtn").onclick=()=>createPile();

    /* ---------- “Most important →” tag anchored to Pile 1 center ---------- */
    function ensureSideTagAnchored(){
      // remove old tag
      document.querySelectorAll('.sideTag').forEach(n=>n.remove());
      const firstPile = pilesCol.querySelector('.pile');
      if (!firstPile) return;
      const tag=document.createElement('div');
      tag.className='sideTag';
      tag.textContent='Most important →';
      firstPile.appendChild(tag);
    }

    /* ---------- Data handshake to Qualtrics ---------- */
    function readList(el){ return Array.from(el.children).map(ch=>ch.dataset.card); }
    function getResults(){
      return {
        meta:{ startedAt: window.__startedAt || new Date().toISOString(), finishedAt: new Date().toISOString(), userAgent: navigator.userAgent },
        allCards: CARDS.slice(),
        piles: Array.from(pilesCol.children).map((p,idx)=>({ id: p.querySelector('.pileList').id, index: idx+1, cards: readList(p.querySelector('.pileList')) })),
        unplaced: readList(allList)
      };
    }
    window.__startedAt = new Date().toISOString();

    window.addEventListener('message',(e)=>{
      const msg=e.data||{};
      if(msg.type==='qualtrics:requestData'){
        const payload=getResults();
        parent.postMessage({ type:'qualtrics:payload', payload:{ ...payload, remainingInAllCards: payload.unplaced.length } }, targetOrigin);
      }
    });

    /* ---------- Auto-height: start tall + keep resizing ---------- */
    function notifyHeight(){
      const h=Math.max(
        document.documentElement.scrollHeight,
        document.body.scrollHeight,
        document.documentElement.offsetHeight,
        document.body.offsetHeight
      );
      parent.postMessage({ type:'iframesizer:height', height:h }, '*');
    }
    // start with extra content height to reduce early scroll, then keep resizing
    const ro = new ResizeObserver(()=>notifyHeight());
    ro.observe(document.body);
    window.addEventListener('load', ()=>{ document.body.style.minHeight = '1200px'; notifyHeight(); });
    setTimeout(notifyHeight, 120);
  </script>
</body>
</html>


